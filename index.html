<!DOCTYPE html>

<link rel="stylesheet" href="style.css">
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Mr+Dafoe&display=swap" rel="stylesheet">

<title>
    totally not a taser :3
</title>

<body>
    <div id="gif-container" style="text-align: center; margin-top: 20px;"></div>
    <style>
        body {
            background-color: #E94E56;
        }
        body {
            text-align: center;
            font-family: Arial, sans-serif;
        }
        .slot-container {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100px;
            width: 80px;
            font-size: 50px;
            border: 2px solid black;
            overflow: hidden;
            margin: 0 auto;
        }
        .slot-number {
            transition: transform 2s ease-out;
            display: flex;
            justify-content: center;
            align-items: center;
            width: 100%;
            height: 100%;
        }
        button {
            margin-top: 20px;
            font-size: 20px;
            padding: 10px;
        }
    </style>
    <h1 style="font-family: Mr Dafoe, cursive; font-weight: 400; font-style: normal; color: #ff007b;">
        welcome to the best non-gambling website for young children
    </h1>
    <h2 style="font-family: Mr Dafoe, cursive; font-weight: 400; font-style: normal; color: #ff007b;">
        this website contains absolutely NO gambling content whatsoever and is absolutely safe for children of all ages
    </h2>

    <h3 style="font-family: Mr Dafoe, cursive; font-weight: 400; font-style: normal; color: #ff007b;">
        before starting the activities hosted on this page please ensure to wear the fun bracelet that we've provided, ensuring the metal contacts are touching your skin (don't worry about those teehee)
    </h3>

    <h4 style="font-family: Mr Dafoe, cursive; font-weight: 400; font-style: normal; color: #ff007b;">
        the goal of this game is to get 10 or 1 on the spinner wheel, if you get anything other than 10 you MAY be subjected to tasing

        and yes the spinner can in fact land on the winning numbers, it's just rare
    </h4>
    <div class="slot-container" style="font-family: Mr Dafoe, cursive; font-weight: 400; font-style: normal; color: #ff007b;">
        <div class="slot-number">0</div>
    </div>
    <button onclick="spinSlot()">gamble</button>

    <script>
        function spinSlot() {
            // Reset GPIO pins
            const serverIp = "http://192.168.137.19"; // Replace with your server's IP address
            fetch(`${serverIp}/reset_pins`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                }
            })
            .then(response => response.json())
            .then(data => console.log("Reset pins response:", data))
            .catch(error => console.error('Error resetting pins:', error));

            // clear rickroll if it exists
            const gifContainer = document.getElementById('gif-container');
            gifContainer.innerHTML = "";
            const slot = document.querySelector('.slot-number');    
            let spinTime = Math.floor(Math.random() * 3000) + 5000; // Random number 5000-8000ms
            let randomStop = Math.floor(Math.random() * 10) + 1; // generate random number from 1-10
            
            // Generate fake spinning effect
            let count = 0;
            let interval = setInterval(() => {
                slot.textContent = count % 10 + 1;
                count++;
            }, 100); // Change number every 100ms
            
            // Stop after spinTime
            setTimeout(() => {
                clearInterval(interval);
                slot.textContent = randomStop;
                triggerRaspberryPi(randomStop);
            }, spinTime);
        }

        function triggerRaspberryPi(number) {
            console.log("Slot landed on:", number);
            const gifContainer = document.getElementById('gif-container');
            const serverIp = "http://192.168.137.19"; // Replace with your server's IP address
            if (number === 10 || number === 1) {
                console.log("you win this time...");
                gifContainer.innerHTML = `<img src="${serverIp}/win.gif" alt="You win!">`;
            } else {
                console.log("you lost! womp womp");
                gifContainer.innerHTML = `<img src="${serverIp}/lose.gif" alt="You lost!">`;
            }

            // Make API call to run the taser or win action
            fetch(`${serverIp}/run_taser`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ "number": number })
            })
            .then(response => response.json())
            .then(data => console.log("Run taser response:", data))
            .catch(error => console.error('Error running taser:', error));
        }
    </script>
</body>